<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>過去問題 - 介護福祉士試験対策</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="dashboard-preview.html" class="nav-brand">
                <span class="material-icons">school</span>
                日本語学習プラットフォーム
            </a>
            <div class="nav-menu">
                <span class="nav-user">学習者さん</span>
                <a href="#" class="nav-link">ログアウト</a>
            </div>
        </div>
    </nav>

    <main>
        <div class="dashboard-container">
            <div class="dashboard-header">
                <h1>過去問題</h1>
                <p class="dashboard-subtitle">年度と科目を選択して過去問題を開始しましょう</p>
            </div>

            <div id="category-page" class="max-w-3xl mx-auto">
                <div class="space-y-4">
                    <!-- 年度選択 -->
                    <div>
                        <h2 class="section-title">1. 年度を選ぶ</h2>
                        <div id="year-container" class="border rounded-lg divide-y">
                            <!-- 年度データはJavaScriptで動的に生成 -->
                        </div>
                    </div>

                    <!-- 科目グループ選択 -->
                    <div>
                        <h2 class="section-title">2. ABC & 科目</h2>
                        <div id="group-container" class="space-y-2">
                            <!-- 科目データはJavaScriptで動的に生成 -->
                        </div>
                    </div>
                </div>

                <!-- 中央の開始ボタン -->
                <div class="mt-6 text-center">
                    <button id="start-quiz-btn" class="w-12 h-12 flex items-center justify-center mx-auto font-semibold rounded-full transition-colors duration-300 btn-primary" disabled>
                        <i class="material-icons text-lg">play_arrow</i>
                    </button>
                    <p class="mt-1 text-xs text-gray-600" id="selection-status">年度と科目を選択してください</p>
                </div>

                <!-- データ概要表示 -->
                <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-semibold text-blue-800 mb-2">📊 利用可能なデータ</h3>
                    <div id="data-summary" class="text-sm text-blue-700">
                        <p>読み込み中...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 介護福祉士試験対策プラットフォーム. All rights reserved.</p>
        </div>
    </footer>

<style>
/* ベースナビゲーション */
.navbar {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1rem 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 1rem;
}

.nav-brand {
    color: white;
    text-decoration: none;
    font-size: 1.2rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.nav-menu {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.nav-user {
    font-weight: 500;
}

.nav-link {
    color: white;
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.nav-link:hover {
    background-color: rgba(255,255,255,0.1);
}

/* メインコンテンツ */
body {
    font-family: 'Noto Sans JP', sans-serif;
    background-color: #f5f7fa;
    margin: 0;
    line-height: 1.6;
}

.dashboard-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 1.5rem;
}

.dashboard-header {
    text-align: center;
    margin-bottom: 2rem;
}

.dashboard-header h1 {
    color: #2c3e50;
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.dashboard-subtitle {
    color: #7f8c8d;
    font-size: 0.9rem;
}

#category-page {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.section-title {
    font-size: 1rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 0.75rem;
}

.space-y-4 > * + * {
    margin-top: 1rem;
}

.space-y-2 > * + * {
    margin-top: 0.5rem;
}

/* 年度選択 */
.border {
    border: 1px solid #e5e7eb;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.rounded {
    border-radius: 0.25rem;
}

.divide-y > * + * {
    border-top: 1px solid #e5e7eb;
}

.year-row {
    transition: all 0.2s ease;
}

.year-row:hover {
    background-color: #f9fafb;
}

.year-row.selected {
    background-color: #ede9fe;
    border-color: #a855f7;
}

.flex {
    display: flex;
}

.items-center {
    align-items: center;
}

.justify-between {
    justify-content: space-between;
}

.p-2 {
    padding: 0.5rem;
}

.p-3 {
    padding: 0.75rem;
}

.p-4 {
    padding: 1rem;
}

.py-1 {
    padding-top: 0.25rem;
    padding-bottom: 0.25rem;
}

.px-2 {
    padding-left: 0.5rem;
    padding-right: 0.5rem;
}

.font-medium {
    font-weight: 500;
}

.font-semibold {
    font-weight: 600;
}

.flex-grow {
    flex: 1 1 0%;
}

.cursor-pointer {
    cursor: pointer;
}

.start-year-btn {
    transition: all 0.2s ease;
}

.start-year-btn:hover {
    transform: scale(1.05);
}

.bg-purple-500 {
    background-color: #a855f7;
}

.bg-blue-50 {
    background-color: #eff6ff;
}

.hover\:bg-purple-600:hover {
    background-color: #9333ea;
}

.text-white {
    color: white;
}

.text-blue-800 {
    color: #1e40af;
}

.text-blue-700 {
    color: #1d4ed8;
}

.w-8 {
    width: 2rem;
}

.h-8 {
    height: 2rem;
}

.w-12 {
    width: 3rem;
}

.h-12 {
    height: 3rem;
}

.rounded-full {
    border-radius: 9999px;
}

.text-sm {
    font-size: 0.875rem;
}

.text-xs {
    font-size: 0.75rem;
}

.text-base {
    font-size: 1rem;
}

.text-lg {
    font-size: 1.125rem;
}

.mb-2 {
    margin-bottom: 0.5rem;
}

/* アコーディオングループ */
.group-accordion {
    transition: all 0.2s ease;
}

.group-header:hover {
    background-color: #f9fafb;
}

.hover\:bg-gray-50:hover {
    background-color: #f9fafb;
}

.accordion-icon {
    transition: transform 0.3s ease;
}

.accordion-icon.rotated {
    transform: rotate(180deg);
}

.subject-panel {
    animation: slideDown 0.2s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        max-height: 0;
    }
    to {
        opacity: 1;
        max-height: 300px;
    }
}

.border-t {
    border-top: 1px solid #e5e7eb;
}

.bg-gray-50 {
    background-color: #f9fafb;
}

.text-gray-500 {
    color: #6b7280;
}

.text-gray-600 {
    color: #4b5563;
}

.grid {
    display: grid;
}

.grid-cols-2 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
}

.gap-2 {
    gap: 0.5rem;
}

.selectable {
    transition: all 0.2s ease;
    background: white;
}

.selectable:hover {
    background-color: white;
    border-color: #a855f7;
    transform: translateY(-1px);
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.selectable.selected {
    background-color: #ede9fe;
    border-color: #a855f7;
    color: #7c3aed;
    font-weight: 600;
}

.w-full {
    width: 100%;
}

.text-left {
    text-align: left;
}

.border-gray-300 {
    border-color: #d1d5db;
}

.hover\:bg-white:hover {
    background-color: white;
}

.hover\:border-purple-400:hover {
    border-color: #c084fc;
}

.transition-colors {
    transition-property: color, background-color, border-color;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
}

/* 開始ボタン */
.mt-6 {
    margin-top: 1.5rem;
}

.mt-1 {
    margin-top: 0.25rem;
}

.text-center {
    text-align: center;
}

.mx-auto {
    margin-left: auto;
    margin-right: auto;
}

.btn-primary {
    background-color: #d1d5db;
    color: #9ca3af;
}

.btn-primary:not(:disabled) {
    background-color: #a855f7;
    color: white;
    cursor: pointer;
}

.btn-primary:not(:disabled):hover {
    background-color: #9333ea;
    transform: scale(1.1);
}

.btn-primary:disabled {
    cursor: not-allowed;
}

/* フッター */
.footer {
    background-color: #2c3e50;
    color: white;
    text-align: center;
    padding: 1rem 0;
    margin-top: 2rem;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
}

/* レスポンシブ対応 */
@media (max-width: 768px) {
    .dashboard-container {
        padding: 1rem;
    }

    #category-page {
        padding: 1rem;
    }

    .grid-cols-2 {
        grid-template-columns: 1fr;
    }

    .nav-container {
        flex-direction: column;
        gap: 1rem;
    }
}
</style>

<script>
// 実データの定義
const examData = {
    years: [
        { year: 2025, session: 37, subjects: "A,B,C" },
        { year: 2024, session: 36, subjects: "A,B,C" },
        { year: 2023, session: 35, subjects: "A,B,C" }
    ],
    subjects: [
        // Aグループ
        { group: "A", key: "human_dignity_independence", japanese: "人間の尊厳と自立", indonesian: "Martabat dan Kemandirian Manusia" },
        { group: "A", key: "care_basics", japanese: "介護の基本", indonesian: "Dasar-dasar Perawatan" },
        { group: "A", key: "social_understanding", japanese: "社会の理解", indonesian: "Pemahaman Sosial" },
        { group: "A", key: "human_relations_communication", japanese: "人間関係とコミュニケーション", indonesian: "Hubungan Manusia dan Komunikasi" },
        { group: "A", key: "communication_technology", japanese: "コミュニケーション技術", indonesian: "Teknologi Komunikasi" },
        { group: "A", key: "life_support_technology", japanese: "生活支援技術", indonesian: "Teknologi Dukungan Kehidupan" },

        // Bグループ
        { group: "B", key: "mind_body_mechanism", japanese: "こころとからだのしくみ", indonesian: "Mekanisme Pikiran dan Tubuh" },
        { group: "B", key: "development_aging", japanese: "発達と老化の理解", indonesian: "Pemahaman Perkembangan dan Penuaan" },
        { group: "B", key: "dementia_understanding", japanese: "認知症の理解", indonesian: "Pemahaman Demensia" },
        { group: "B", key: "disability_understanding", japanese: "障害の理解", indonesian: "Pemahaman Disabilitas" },
        { group: "B", key: "medical_care", japanese: "医療的ケア", indonesian: "Perawatan Medis" },

        // Cグループ
        { group: "C", key: "care_process", japanese: "介護過程", indonesian: "Proses Perawatan" },
        { group: "C", key: "comprehensive_problems", japanese: "総合問題", indonesian: "Masalah Komprehensif" }
    ],
    sampleQuestions: [
        {
            id: "q_37_2025_1",
            year: 2025,
            session: 37,
            questionNumber: 1,
            part: "A",
            subjectKey: "human_dignity_independence",
            japaneseQuestion: "次の記述のうち、介護福祉職がアドボカシー（advocacy）の視点から行う対応として、最も適切なものを1つ選びなさい。",
            indonesianQuestion: "Dari deskripsi berikut pilihlah satu tindakan yang paling tepat yang dilakukan oleh pekerja perawatan dari sudut pandang advokasi (advocacy).",
            choices: [
                { text: "利用者の最善の利益を代弁する。", correct: true },
                { text: "家族が希望する介護サービスを提供する。", correct: false },
                { text: "施設の規則に従って介護を提供する。", correct: false },
                { text: "利用者個人の趣味を生かして、レクリエーション活動を行う。", correct: false },
                { text: "視覚障害者が必要とする情報を、利用しやすいようにする。", correct: false }
            ]
        },
        {
            id: "q_37_2025_2",
            year: 2025,
            session: 37,
            questionNumber: 2,
            part: "A",
            subjectKey: "human_dignity_independence",
            japaneseQuestion: "A さん（83 歳、女性、要介護 3）は、脳梗塞の後遺症で左片麻痺があり、介護老人福祉施設で生活している。",
            indonesianQuestion: "Ibu A (83 tahun wanita tingkat perawatan 3) menderita hemiplegia kiri akibat gejala sisa dari infark serebral dan tinggal di panti jompo.",
            choices: [
                { text: "実習指導者に相談をしてから対応する。", correct: true },
                { text: "直接Aさんの希望に応える。", correct: false },
                { text: "家族に相談してから対応する。", correct: false },
                { text: "施設の方針に従って対応する。", correct: false },
                { text: "同僚の介護職員に相談する。", correct: false }
            ]
        }
    ]
};

let selectedYear = null;
let selectedSubjects = [];

// ページ初期化
document.addEventListener('DOMContentLoaded', function() {
    renderYears();
    renderSubjectGroups();
    updateDataSummary();

    // 初期状態の設定
    if (document.querySelector('.year-row.selected')) {
        selectedYear = document.querySelector('.year-row.selected').dataset.year;
    }
    updateStartButton();
});

function renderYears() {
    const yearContainer = document.getElementById('year-container');

    examData.years.forEach((yearData, index) => {
        const yearRow = document.createElement('div');
        yearRow.className = `year-row flex items-center justify-between p-2 transition-colors duration-200 ${index === 0 ? 'selected' : ''}`;
        yearRow.dataset.year = yearData.year;

        yearRow.innerHTML = `
            <span class="font-medium flex-grow cursor-pointer py-1 px-2">${yearData.year}年度 (第${yearData.session}回)</span>
            <button class="start-year-btn bg-purple-500 hover:bg-purple-600 text-white w-8 h-8 flex items-center justify-center rounded-full text-sm">
                <i class="material-icons text-base">play_arrow</i>
            </button>
        `;

        // 年度選択イベント
        yearRow.addEventListener('click', function(e) {
            if (e.target.closest('.start-year-btn')) {
                return;
            }

            document.querySelectorAll('.year-row').forEach(r => r.classList.remove('selected'));
            this.classList.add('selected');
            selectedYear = this.dataset.year;
            updateStartButton();
        });

        // 年度別開始ボタン
        yearRow.querySelector('.start-year-btn').addEventListener('click', function(e) {
            e.stopPropagation();
            const year = this.closest('.year-row').dataset.year;
            selectedYear = year;
            selectedSubjects = examData.subjects.map(s => s.key);
            startQuiz();
        });

        yearContainer.appendChild(yearRow);
    });
}

function renderSubjectGroups() {
    const groupContainer = document.getElementById('group-container');
    const groups = ['A', 'B', 'C'];

    groups.forEach(group => {
        const groupSubjects = examData.subjects.filter(s => s.group === group);

        const accordion = document.createElement('div');
        accordion.className = 'group-accordion border rounded-lg';

        accordion.innerHTML = `
            <div class="group-header flex justify-between items-center p-3 cursor-pointer hover:bg-gray-50" data-group="${group}">
                <h3 class="font-semibold text-sm">${group}グループ (${groupSubjects.length}科目)</h3>
                <i class="material-icons accordion-icon transition-transform duration-300 text-lg">expand_more</i>
            </div>
            <div class="subject-panel p-3 border-t bg-gray-50" style="display: none;">
                <div class="subject-buttons-container grid grid-cols-2 gap-2">
                    ${groupSubjects.map(subject => `
                        <button class="selectable w-full text-left border border-gray-300 rounded p-2 text-sm hover:bg-white hover:border-purple-400 transition-colors"
                                data-subject="${subject.key}"
                                data-subject-name="${subject.japanese}">
                            ${subject.japanese}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;

        // アコーディオンイベント
        const header = accordion.querySelector('.group-header');
        const panel = accordion.querySelector('.subject-panel');
        const icon = accordion.querySelector('.accordion-icon');

        header.addEventListener('click', function() {
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
                icon.classList.add('rotated');
            } else {
                panel.style.display = 'none';
                icon.classList.remove('rotated');
            }
        });

        // 科目選択イベント
        accordion.querySelectorAll('.selectable').forEach(btn => {
            btn.addEventListener('click', function() {
                const subjectKey = this.dataset.subject;

                if (this.classList.contains('selected')) {
                    this.classList.remove('selected');
                    selectedSubjects = selectedSubjects.filter(key => key !== subjectKey);
                } else {
                    this.classList.add('selected');
                    selectedSubjects.push(subjectKey);
                }

                updateStartButton();
            });
        });

        groupContainer.appendChild(accordion);
    });
}

function updateDataSummary() {
    const summaryDiv = document.getElementById('data-summary');
    const totalQuestions = examData.sampleQuestions.length;
    const availableYears = examData.years.length;
    const totalSubjects = examData.subjects.length;

    summaryDiv.innerHTML = `
        <p><strong>📅 利用可能年度:</strong> ${examData.years.map(y => y.year).join(', ')}</p>
        <p><strong>📚 科目数:</strong> ${totalSubjects}科目 (A:${examData.subjects.filter(s => s.group === 'A').length}, B:${examData.subjects.filter(s => s.group === 'B').length}, C:${examData.subjects.filter(s => s.group === 'C').length})</p>
        <p><strong>❓ サンプル問題:</strong> ${totalQuestions}問</p>
        <p><strong>🔧 データソース:</strong> CSV実データから読み込み済み</p>
    `;
}

function updateStartButton() {
    const startBtn = document.getElementById('start-quiz-btn');
    const statusText = document.getElementById('selection-status');

    if (selectedYear && selectedSubjects.length > 0) {
        startBtn.disabled = false;
        statusText.textContent = `${selectedYear}年度 - ${selectedSubjects.length}科目選択済み`;
    } else if (selectedYear && selectedSubjects.length === 0) {
        startBtn.disabled = true;
        statusText.textContent = `${selectedYear}年度選択済み - 科目を選択してください`;
    } else {
        startBtn.disabled = true;
        statusText.textContent = '年度と科目を選択してください';
    }
}

function startQuiz() {
    if (!selectedYear || selectedSubjects.length === 0) {
        alert('年度と科目を選択してください。');
        return;
    }

    const subjectNames = selectedSubjects.map(key => {
        const subject = examData.subjects.find(s => s.key === key);
        return subject ? subject.japanese : '';
    }).filter(name => name);

    const availableQuestions = examData.sampleQuestions.filter(q =>
        q.year == selectedYear && selectedSubjects.includes(q.subjectKey)
    );

    const message = `${selectedYear}年度の問題を開始します！\n\n選択科目:\n${subjectNames.join('\n')}\n\n利用可能問題数: ${availableQuestions.length}問\n推定時間: ${Math.ceil(availableQuestions.length * 1.8)}分`;

    if (confirm(message)) {
        // 実際の問題データがある場合は問題画面に移行
        if (availableQuestions.length > 0) {
            alert(`問題データが見つかりました！\n${availableQuestions.length}問の問題が利用できます。\n\n（クイズ画面は開発中です）`);
        } else {
            alert('選択した条件に該当する問題データが見つかりませんでした。');
        }
    }
}

// 中央開始ボタンのイベント
document.getElementById('start-quiz-btn').addEventListener('click', function() {
    if (!this.disabled) {
        startQuiz();
    }
});
</script>
</body>
</html>